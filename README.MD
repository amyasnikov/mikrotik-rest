# MikroTik REST
This project consists of 2 main apps:
* **Mikrotik RESTful API server (mikrotik-rest)**. It gets REST API calls and translates it to Mikrotik API calls. It is built on top of Flask and [Connexion](https://github.com/zalando/connexion). This app requires full API specification in swagger/openapi format. The specification need to be generated by another app in this repo. 
* **OpenAPI specification generator (specgen)**. This app connects to some real MikroTik device via ssh and parse all available CLI commands using **Tab** key. It builds the tree of all availablre CLI commands and then generates an OpenAPI Specification file using Jinja2 template. Generated file then can be used in mikrotik-rest app.

## Quickstart
The easiest way to start the mikrotik-rest server is through docker.

```docker run -d -e MIKROTIK_USER=test -e MIKROTIK_PASSWD=test -p 8080:8080 myantt/mikrotik-rest```

Now you can open your browser at
http://localhost:8080/v1/ui/
to see the Swagger UI. It helps to discover all available API endpoints and methods.
By default this server is using the spec generated from Mikrotik hAP Lite router. If you want some another spec, then you have to generate it by yourself using **specgen**.


To run **specgen** app  you need to type the following:

```docker run --rm -it specgen 192.168.0.99 user password > /path/to/mikrotik-rest/api/spec.yaml```

In this example:
* `192.168.0.99` - MikroTik IP address
* `user` - MikroTik username
* `password` - MikroTik password

Configuration parsing requires a lot of consecutive queries to mikrotik and may take significant amount of time  (10-20 mins), please be patient.


## API Calls Examples

Let's say we want to get all IP addresses (**/ip address** menu from MikroTik CLI) of the router with mgmt IP 192.168.0.99
```
$ curl -X GET "http://localhost:8080/v1/192.168.0.99/ip/address" -H  "accept: application/json"
[
  {
    ".id": "*5",
    "actual-interface": "LAN",
    "address": "192.168.0.99/24",
    "disabled": false,
    "dynamic": false,
    "interface": "LAN",
    "invalid": false,
    "network": "192.168.0.0"
  },
  {
    ".id": "*E",
    "actual-interface": "ether1",
    "address": "242.33.238.109/24",
    "disabled": false,
    "dynamic": false,
    "interface": "ether1",
    "invalid": false,
    "network": "242.33.238.0"
  },
  {
    ".id": "*1E",
    "actual-interface": "wlan1",
    "address": "192.168.43.121/24",
    "disabled": false,
    "dynamic": true,
    "interface": "wlan1",
    "invalid": false,
    "network": "192.168.43.0"
  }
]
```
If we want to add a new ip address, then we need to use HTTP POST at the same URL and fill required parameters (at least *interface* and *address*) in the request body.
```
$ curl -X POST "http://localhost:8080/v1/192.168.0.99/ip/address" -H  "accept: application/json" -H  "Content-Type: application/json" -d '{"address":"203.0.113.1/25", "interface":"ether4"}'
{
  ".id": "*20"
}
```
The returned value **\*20** is the MikroTik internal ID for created entity.
